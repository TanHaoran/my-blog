<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVM性能优化 | 林山夕风</title>
    <meta name="description" content="林山夕风的博客,md文档,技术博客">
    <meta name="generator" content="VuePress 1.3.0">
    <link rel="icon" href="/my-blog/avatar.jpg">
  <script>
                var _hmt = _hmt || [];
                (function() {
                    var hm = document.createElement("script");
                    hm.src = "https://hm.baidu.com/hm.js?68e7a949df184c1e4c82b115461e51e0";
                    var s = document.getElementsByTagName("script")[0];
                    s.parentNode.insertBefore(hm, s);
                })();
            </script>
    
    <link rel="preload" href="/my-blog/assets/css/0.styles.67b6080f.css" as="style"><link rel="preload" href="/my-blog/assets/js/app.11c55fdf.js" as="script"><link rel="preload" href="/my-blog/assets/js/2.f643b0a2.js" as="script"><link rel="preload" href="/my-blog/assets/js/14.ca26e948.js" as="script"><link rel="preload" href="/my-blog/assets/js/4.fd36f240.js" as="script"><link rel="preload" href="/my-blog/assets/js/5.628d6842.js" as="script"><link rel="prefetch" href="/my-blog/assets/js/10.f4eaa613.js"><link rel="prefetch" href="/my-blog/assets/js/100.07e38629.js"><link rel="prefetch" href="/my-blog/assets/js/101.dcfe2bf2.js"><link rel="prefetch" href="/my-blog/assets/js/102.209999b3.js"><link rel="prefetch" href="/my-blog/assets/js/103.a9a85d34.js"><link rel="prefetch" href="/my-blog/assets/js/104.fdefe1dc.js"><link rel="prefetch" href="/my-blog/assets/js/105.e4b5d0af.js"><link rel="prefetch" href="/my-blog/assets/js/106.cf83f84b.js"><link rel="prefetch" href="/my-blog/assets/js/107.848b42d5.js"><link rel="prefetch" href="/my-blog/assets/js/108.351fb64c.js"><link rel="prefetch" href="/my-blog/assets/js/109.4b9111f6.js"><link rel="prefetch" href="/my-blog/assets/js/11.5d5723d1.js"><link rel="prefetch" href="/my-blog/assets/js/110.7f24fb6a.js"><link rel="prefetch" href="/my-blog/assets/js/111.28300395.js"><link rel="prefetch" href="/my-blog/assets/js/112.839af357.js"><link rel="prefetch" href="/my-blog/assets/js/113.67de001a.js"><link rel="prefetch" href="/my-blog/assets/js/114.408ea2f6.js"><link rel="prefetch" href="/my-blog/assets/js/115.34a1d81a.js"><link rel="prefetch" href="/my-blog/assets/js/116.f510ca2c.js"><link rel="prefetch" href="/my-blog/assets/js/117.24ddf316.js"><link rel="prefetch" href="/my-blog/assets/js/12.06fcb150.js"><link rel="prefetch" href="/my-blog/assets/js/13.c441de9d.js"><link rel="prefetch" href="/my-blog/assets/js/15.e7761bd0.js"><link rel="prefetch" href="/my-blog/assets/js/16.5be4d33f.js"><link rel="prefetch" href="/my-blog/assets/js/17.4426a95c.js"><link rel="prefetch" href="/my-blog/assets/js/18.7d974f8d.js"><link rel="prefetch" href="/my-blog/assets/js/19.775995bc.js"><link rel="prefetch" href="/my-blog/assets/js/20.71c35e12.js"><link rel="prefetch" href="/my-blog/assets/js/21.741a18a7.js"><link rel="prefetch" href="/my-blog/assets/js/22.819a7e85.js"><link rel="prefetch" href="/my-blog/assets/js/23.f9133433.js"><link rel="prefetch" href="/my-blog/assets/js/24.86a7d541.js"><link rel="prefetch" href="/my-blog/assets/js/25.0aa2d6ab.js"><link rel="prefetch" href="/my-blog/assets/js/26.3e55392e.js"><link rel="prefetch" href="/my-blog/assets/js/27.ae2e0581.js"><link rel="prefetch" href="/my-blog/assets/js/28.aaa62b88.js"><link rel="prefetch" href="/my-blog/assets/js/29.55007ae9.js"><link rel="prefetch" href="/my-blog/assets/js/3.57915124.js"><link rel="prefetch" href="/my-blog/assets/js/30.63aac023.js"><link rel="prefetch" href="/my-blog/assets/js/31.d5607214.js"><link rel="prefetch" href="/my-blog/assets/js/32.a7ae912b.js"><link rel="prefetch" href="/my-blog/assets/js/33.58fcbfa4.js"><link rel="prefetch" href="/my-blog/assets/js/34.8538d781.js"><link rel="prefetch" href="/my-blog/assets/js/35.14a82428.js"><link rel="prefetch" href="/my-blog/assets/js/36.2ad806dd.js"><link rel="prefetch" href="/my-blog/assets/js/37.207a29ce.js"><link rel="prefetch" href="/my-blog/assets/js/38.57c0d12e.js"><link rel="prefetch" href="/my-blog/assets/js/39.83aff8a9.js"><link rel="prefetch" href="/my-blog/assets/js/40.bcbcfd03.js"><link rel="prefetch" href="/my-blog/assets/js/41.d0a94dfd.js"><link rel="prefetch" href="/my-blog/assets/js/42.f6011b50.js"><link rel="prefetch" href="/my-blog/assets/js/43.efd29b4c.js"><link rel="prefetch" href="/my-blog/assets/js/44.e5c9709c.js"><link rel="prefetch" href="/my-blog/assets/js/45.7656da3c.js"><link rel="prefetch" href="/my-blog/assets/js/46.0f46c833.js"><link rel="prefetch" href="/my-blog/assets/js/47.40ce4540.js"><link rel="prefetch" href="/my-blog/assets/js/48.3db9c583.js"><link rel="prefetch" href="/my-blog/assets/js/49.53285ac3.js"><link rel="prefetch" href="/my-blog/assets/js/50.4db56f99.js"><link rel="prefetch" href="/my-blog/assets/js/51.188f8c4f.js"><link rel="prefetch" href="/my-blog/assets/js/52.95be221e.js"><link rel="prefetch" href="/my-blog/assets/js/53.276e1791.js"><link rel="prefetch" href="/my-blog/assets/js/54.2fd73796.js"><link rel="prefetch" href="/my-blog/assets/js/55.c90a5bd8.js"><link rel="prefetch" href="/my-blog/assets/js/56.406f89df.js"><link rel="prefetch" href="/my-blog/assets/js/57.811f05ab.js"><link rel="prefetch" href="/my-blog/assets/js/58.e2896a54.js"><link rel="prefetch" href="/my-blog/assets/js/59.e5f3be54.js"><link rel="prefetch" href="/my-blog/assets/js/6.8ba90f8e.js"><link rel="prefetch" href="/my-blog/assets/js/60.e4b67c15.js"><link rel="prefetch" href="/my-blog/assets/js/61.7b772903.js"><link rel="prefetch" href="/my-blog/assets/js/62.bbe4352b.js"><link rel="prefetch" href="/my-blog/assets/js/63.e350ef3b.js"><link rel="prefetch" href="/my-blog/assets/js/64.7b6ca2f6.js"><link rel="prefetch" href="/my-blog/assets/js/65.76baf7fa.js"><link rel="prefetch" href="/my-blog/assets/js/66.ff801cea.js"><link rel="prefetch" href="/my-blog/assets/js/67.ee30cd5b.js"><link rel="prefetch" href="/my-blog/assets/js/68.0f4c1ce2.js"><link rel="prefetch" href="/my-blog/assets/js/69.111ce4de.js"><link rel="prefetch" href="/my-blog/assets/js/7.55078740.js"><link rel="prefetch" href="/my-blog/assets/js/70.46f8b5e8.js"><link rel="prefetch" href="/my-blog/assets/js/71.675e279c.js"><link rel="prefetch" href="/my-blog/assets/js/72.c419d947.js"><link rel="prefetch" href="/my-blog/assets/js/73.6eb4799a.js"><link rel="prefetch" href="/my-blog/assets/js/74.18229d2e.js"><link rel="prefetch" href="/my-blog/assets/js/75.46c8298d.js"><link rel="prefetch" href="/my-blog/assets/js/76.c966d3c5.js"><link rel="prefetch" href="/my-blog/assets/js/77.b31efc9c.js"><link rel="prefetch" href="/my-blog/assets/js/78.f7e57735.js"><link rel="prefetch" href="/my-blog/assets/js/79.e056b5a5.js"><link rel="prefetch" href="/my-blog/assets/js/8.ddecccf2.js"><link rel="prefetch" href="/my-blog/assets/js/80.0fc539d1.js"><link rel="prefetch" href="/my-blog/assets/js/81.2b7f0d10.js"><link rel="prefetch" href="/my-blog/assets/js/82.d3e4b716.js"><link rel="prefetch" href="/my-blog/assets/js/83.3073a1d2.js"><link rel="prefetch" href="/my-blog/assets/js/84.d231aeff.js"><link rel="prefetch" href="/my-blog/assets/js/85.7daed020.js"><link rel="prefetch" href="/my-blog/assets/js/86.0c8d8d8e.js"><link rel="prefetch" href="/my-blog/assets/js/87.c4ba5f03.js"><link rel="prefetch" href="/my-blog/assets/js/88.9a4e0ef6.js"><link rel="prefetch" href="/my-blog/assets/js/89.b7bca56b.js"><link rel="prefetch" href="/my-blog/assets/js/9.7463f385.js"><link rel="prefetch" href="/my-blog/assets/js/90.49ec4345.js"><link rel="prefetch" href="/my-blog/assets/js/91.84cb7a66.js"><link rel="prefetch" href="/my-blog/assets/js/92.cb5ea946.js"><link rel="prefetch" href="/my-blog/assets/js/93.05e2ac79.js"><link rel="prefetch" href="/my-blog/assets/js/94.e60969c0.js"><link rel="prefetch" href="/my-blog/assets/js/95.688af442.js"><link rel="prefetch" href="/my-blog/assets/js/96.aba3a873.js"><link rel="prefetch" href="/my-blog/assets/js/97.ca8196eb.js"><link rel="prefetch" href="/my-blog/assets/js/98.071b3a0f.js"><link rel="prefetch" href="/my-blog/assets/js/99.eca50447.js">
    <link rel="stylesheet" href="/my-blog/assets/css/0.styles.67b6080f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-blog/" class="home-link router-link-active"><!----> <span class="site-name">林山夕风</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础教程" class="dropdown-title"><span class="title">基础教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/frontend/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/backend/" class="nav-link router-link-active">
  后端
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/enjoy3/" class="nav-link">
  进阶
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据结构与算法" class="dropdown-title"><span class="title">数据结构与算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/structure/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/algorithm/" class="nav-link">
  算法
</a></li></ul></div></div><div class="nav-item"><a href="/my-blog/leetcode/" class="nav-link">
  LeetCode题解
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计思想" class="dropdown-title"><span class="title">设计思想</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/principle/" class="nav-link">
  设计原则
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/pattern/" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="读书笔记" class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/thinking_in_java/" class="nav-link">
  Java编程思想
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/refactoring_improving_the_design_of_existing_code/" class="nav-link">
  重构改善既有代码的设计
</a></li></ul></div></div><div class="nav-item"><a href="/my-blog/project/" class="nav-link">
  项目实战
</a></div><div class="nav-item"><a href="/my-blog/article/" class="nav-link">
  零散文章
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码管理" class="dropdown-title"><span class="title">代码管理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/doomthr" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/TanHaoran" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/my-blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础教程" class="dropdown-title"><span class="title">基础教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/frontend/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/backend/" class="nav-link router-link-active">
  后端
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/enjoy3/" class="nav-link">
  进阶
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据结构与算法" class="dropdown-title"><span class="title">数据结构与算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/structure/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/algorithm/" class="nav-link">
  算法
</a></li></ul></div></div><div class="nav-item"><a href="/my-blog/leetcode/" class="nav-link">
  LeetCode题解
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计思想" class="dropdown-title"><span class="title">设计思想</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/principle/" class="nav-link">
  设计原则
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/pattern/" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="读书笔记" class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/thinking_in_java/" class="nav-link">
  Java编程思想
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/refactoring_improving_the_design_of_existing_code/" class="nav-link">
  重构改善既有代码的设计
</a></li></ul></div></div><div class="nav-item"><a href="/my-blog/project/" class="nav-link">
  项目实战
</a></div><div class="nav-item"><a href="/my-blog/article/" class="nav-link">
  零散文章
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码管理" class="dropdown-title"><span class="title">代码管理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/doomthr" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/TanHaoran" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基础教程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/my-blog/backend/线程基础.html" class="sidebar-link">线程基础</a></li><li><a href="/my-blog/backend/线程之间的共享和协作.html" class="sidebar-link">线程之间的共享和协作</a></li><li><a href="/my-blog/backend/线程的并发工具类.html" class="sidebar-link">线程的并发工具类</a></li><li><a href="/my-blog/backend/原子操作CAS.html" class="sidebar-link">原子操作CAS</a></li><li><a href="/my-blog/backend/显示锁和AQS.html" class="sidebar-link">显示锁和AQS</a></li><li><a href="/my-blog/backend/并发容器.html" class="sidebar-link">并发容器</a></li><li><a href="/my-blog/backend/线程池.html" class="sidebar-link">线程池</a></li><li><a href="/my-blog/backend/并发安全.html" class="sidebar-link">并发安全</a></li><li><a href="/my-blog/backend/JMM和底层实现原理.html" class="sidebar-link">JMM和底层实现原理</a></li><li><a href="/my-blog/backend/Java8新增的并发.html" class="sidebar-link">Java8新增的并发</a></li><li><a href="/my-blog/backend/常见并发面试题.html" class="sidebar-link">常见并发面试题</a></li><li><a href="/my-blog/backend/深入理解JVM内存区域.html" class="sidebar-link">深入理解JVM内存区域</a></li><li><a href="/my-blog/backend/JVM如何创建对象.html" class="sidebar-link">JVM如何创建对象</a></li><li><a href="/my-blog/backend/垃圾回收算法与垃圾回收器.html" class="sidebar-link">垃圾回收算法与垃圾回收器</a></li><li><a href="/my-blog/backend/JVM执行子系统.html" class="sidebar-link">JVM执行子系统</a></li><li><a href="/my-blog/backend/JVM性能优化.html" class="active sidebar-link">JVM性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#一、内存溢出" class="sidebar-link">一、内存溢出</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#_1、栈溢出" class="sidebar-link">1、栈溢出</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#_2、堆溢出" class="sidebar-link">2、堆溢出</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#_3、直接内存" class="sidebar-link">3、直接内存</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#_4、方法区溢出" class="sidebar-link">4、方法区溢出</a></li></ul></li><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#二、内存泄露" class="sidebar-link">二、内存泄露</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#_1、长生命周期的对象持有短生命周期对象的引用" class="sidebar-link">1、长生命周期的对象持有短生命周期对象的引用</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#_2、连接未关闭" class="sidebar-link">2、连接未关闭</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#_3、变量作用域不合理" class="sidebar-link">3、变量作用域不合理</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#_4、内部类持有外部类" class="sidebar-link">4、内部类持有外部类</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#_5、hash-值改变" class="sidebar-link">5、Hash 值改变</a></li></ul></li><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#三、内存泄露和内存溢出辨析" class="sidebar-link">三、内存泄露和内存溢出辨析</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#四、了解mat" class="sidebar-link">四、了解MAT</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#_1、浅堆和深堆" class="sidebar-link">1、浅堆和深堆</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#_2、incoming-和-outgoing" class="sidebar-link">2、incoming 和 outgoing</a></li></ul></li><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#五、jdk为我们提供的工具" class="sidebar-link">五、JDK为我们提供的工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#_1、命令行工具" class="sidebar-link">1、命令行工具</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/JVM性能优化.html#_2、可视化工具" class="sidebar-link">2、可视化工具</a></li></ul></li></ul></li><li><a href="/my-blog/backend/MySQL安装和基础数据类型.html" class="sidebar-link">MySQL安装和基础数据类型</a></li><li><a href="/my-blog/backend/MySQL体系架构.html" class="sidebar-link">MySQL体系架构</a></li><li><a href="/my-blog/backend/MySQL锁与事务的分析.html" class="sidebar-link">MySQL锁与事务的分析</a></li><li><a href="/my-blog/backend/MySQL业务设计.html" class="sidebar-link">MySQL业务设计</a></li><li><a href="/my-blog/backend/MySQL慢查询.html" class="sidebar-link">MySQL慢查询</a></li><li><a href="/my-blog/backend/MySQL索引和执行计划.html" class="sidebar-link">MySQL索引和执行计划</a></li><li><a href="/my-blog/backend/MySQL的SQL优化.html" class="sidebar-link">MySQL的SQL优化</a></li><li><a href="/my-blog/backend/Linux基础.html" class="sidebar-link">Linux基础</a></li><li><a href="/my-blog/backend/反射：框架设计的灵魂.html" class="sidebar-link">反射：框架设计的灵魂</a></li><li><a href="/my-blog/backend/Java8新增特性.html" class="sidebar-link">Java8新增特性</a></li><li><a href="/my-blog/backend/MyBatis应用.html" class="sidebar-link">MyBatis应用</a></li><li><a href="/my-blog/backend/MyBatis源码骨架分析.html" class="sidebar-link">MyBatis源码骨架分析</a></li><li><a href="/my-blog/backend/MyBatis源码流程分析.html" class="sidebar-link">MyBatis源码流程分析</a></li><li><a href="/my-blog/backend/消息中间件入门，AMQP与RabbitMQ.html" class="sidebar-link">消息中间件入门，AMQP与RabbitMQ</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jvm性能优化"><a href="#jvm性能优化" class="header-anchor">#</a> JVM性能优化</h1> <div><span id="/my-blog/backend/JVM性能优化.html" data-flag-title="JVM性能优化" class="leancloud_visitors read-count"><em class="post-meta-item-text">阅读量 </em> <i class="leancloud-visitors-count">loading</i></span> <div class="clear-both"></div></div> <h2 id="一、内存溢出"><a href="#一、内存溢出" class="header-anchor">#</a> 一、内存溢出</h2> <p>内存溢出的原因：程序在申请内存时，没有足够的内存空间。</p> <h3 id="_1、栈溢出"><a href="#_1、栈溢出" class="header-anchor">#</a> 1、栈溢出</h3> <p>方法死循环递归调用（StackOverflowError）、不断建立线程（<code>OutOfMemoryError</code>）</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StackOverFlow</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">king</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 死递归</span>
        <span class="token function">king</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">StackOverFlow</span> javaStack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StackOverFlow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        javaStack<span class="token punctuation">.</span><span class="token function">king</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>由于死递归会一直申请内存，最终导致没有足够的内存空间。执行结果：</p> <div class="language-console line-numbers-mode"><pre class="language-text"><code>Exception in thread &quot;main&quot; java.lang.StackOverflowError
	at com.jerry.ch5.oom.StackOverFlow.king(StackOverFlow.java:14)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2、堆溢出"><a href="#_2、堆溢出" class="header-anchor">#</a> 2、堆溢出</h3> <p>不断创建对象，分配对象大于最大堆的大小（<code>OutOfMemoryError</code>）</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HeapOom</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果要分配下面这个100m大小的数组（堆），就会直接抛出 java.lang.OutOfMemoryError: Java heap space</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> strings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">100000000</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>启动参数：<code>-Xms30m -Xmx30m</code>，由于申请了 100m大小的数组，肯定超过了内存的30m，执行结果：</p> <div class="language-console line-numbers-mode"><pre class="language-text"><code>Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space
	at com.jerry.ch5.oom.HeapOom.main(HeapOom.java:14)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HeapOom2</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在方法执行的过程中，它是GCRoots。执行会 java.lang.OutOfMemoryError: GC overhead limit exceeded</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            i<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">10000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;i=&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>启动参数：<code>-Xms30m -Xmx30m</code>，执行结果：</p> <div class="language-console line-numbers-mode"><pre class="language-text"><code>i=10000
i=20000
...
i=700000
Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: GC overhead limit exceeded
	at java.util.LinkedList.linkLast(LinkedList.java:142)
	at java.util.LinkedList.add(LinkedList.java:338)
	at com.jerry.ch5.oom.HeapOom2.main(HeapOom2.java:24)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>由于 <code>list</code> 是 <code>GCRoots</code>，所以他一直不会 <code>GC</code>，导致最终内存溢出。</p> <h3 id="_3、直接内存"><a href="#_3、直接内存" class="header-anchor">#</a> 3、直接内存</h3> <p>分配的本地内存大小大于 <code>JVM</code> 的限制</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DirectOom</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 直接分配128M的直接内存(100M)，会抛出 java.lang.OutOfMemoryError: Direct buffer memory</span>
        <span class="token class-name">ByteBuffer</span> bb <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocateDirect</span><span class="token punctuation">(</span><span class="token number">128</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1204</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>启动参数：<code>-XX:MaxDirectMemorySize=100m</code>，执行结果：</p> <div class="language-console line-numbers-mode"><pre class="language-text"><code>Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:694)
	at java.nio.DirectByteBuffer.&lt;init&gt;(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at com.jerry.ch5.oom.DirectOom.main(DirectOom.java:16)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>需要申请 128m的内存，肯定会溢出的。</p> <h3 id="_4、方法区溢出"><a href="#_4、方法区溢出" class="header-anchor">#</a> 4、方法区溢出</h3> <p>在经常动态生产大量 <code>Class</code> 的应用中，<code>CGLIb</code> 字节码增强，动态语言，大量 <code>JSP</code>(<code>JSP</code> 第一次运行需要编译成 <code>Java</code> 类),基于 <code>OSGi</code> 的应用(同一个类，被不同的加载器加载也会设为不同的类)</p> <h2 id="二、内存泄露"><a href="#二、内存泄露" class="header-anchor">#</a> 二、内存泄露</h2> <p>内存泄露的原因：程序在申请内存后，无法释放已申请的内存空间。</p> <h3 id="_1、长生命周期的对象持有短生命周期对象的引用"><a href="#_1、长生命周期的对象持有短生命周期对象的引用" class="header-anchor">#</a> 1、长生命周期的对象持有短生命周期对象的引用</h3> <p>例如将 <code>ArrayList</code> 设置为静态变量，则容器中的对象在程序结束之前将不能被释放，从而造成内存泄漏</p> <h3 id="_2、连接未关闭"><a href="#_2、连接未关闭" class="header-anchor">#</a> 2、连接未关闭</h3> <p>如数据库连接、网络连接和 IO 连接等，只有连接被关闭后，垃圾回收器才会回收对应的对象。</p> <h3 id="_3、变量作用域不合理"><a href="#_3、变量作用域不合理" class="header-anchor">#</a> 3、变量作用域不合理</h3> <p>例如：</p> <ol><li><p>一个变量的定义的作用范围大于其使用范围</p></li> <li><p>如果没有及时地把对象设置为 <code>null</code></p></li></ol> <p>在写 <code>Stack</code> 这种数据机构的时候，在出栈时，有时会忘记将该位置置空。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Stack</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">Cap</span> <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        elements <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token class-name">Cap</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 入栈
     *
     * @param e
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Object</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        elements<span class="token punctuation">[</span>size<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
        size<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 出栈
     *
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        size <span class="token operator">=</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> elements<span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 没有让 GC 回收掉</span>
<span class="token comment">//        elements[size] = null;</span>
        <span class="token keyword">return</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>导致使用的时候：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UseStack</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Stack</span> stack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;o = &quot;</span> <span class="token operator">+</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 入栈</span>
        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 出栈</span>
        <span class="token class-name">Object</span> o1 <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// o对象没什么用</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;o1 = &quot;</span> <span class="token operator">+</span> o1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 打印栈中的数据</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stack<span class="token punctuation">.</span>elements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>执行结果：</p> <div class="language-console line-numbers-mode"><pre class="language-text"><code>o = java.lang.Object@1b6d3586
o1 = java.lang.Object@1b6d3586
java.lang.Object@1b6d3586
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>虽然出栈了，但是居然还能查询到元素。</p> <h3 id="_4、内部类持有外部类"><a href="#_4、内部类持有外部类" class="header-anchor">#</a> 4、内部类持有外部类</h3> <p>Java 的非静态内部类的这种创建方式，会隐式地持有外部类的引用，而且默认情况下这个引用是强引用，因此，如果内部类的生命周期长于外部类的生命周期，程序很容易就产生内存泄漏。</p> <p>如果内部类的生命周期长于外部类的生命周期，程序很容易就产生内存泄漏（你认为垃圾回收器会回收掉外部类的实例，但由于内部类持有外部类的引用，导致垃圾回收器不能正常工作）。</p> <p>解决方法：你可以在内部类的内部显示持有一个外部类的软引用(或弱引用)，并通过构造方法的方式传递进来，在内部类的使用过程中，先判断一下外部类是否被回收。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NoStaticInternal</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> STRING <span class="token operator">=</span> <span class="token string">&quot;King&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">float</span> j <span class="token operator">=</span> <span class="token number">1.5f</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;show&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;add&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">NoStaticInternal</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NoStaticInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 非静态内部类的构造方式</span>
        <span class="token class-name">Child</span> c <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        c<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Inner</span> inner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        inner<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 内部类 Child，可以访问外部类静态和非静态的的成员变量、方法
     */</span>
    <span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;k=:&quot;</span> <span class="token operator">+</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;string: &quot;</span> <span class="token operator">+</span> STRING<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;j=:&quot;</span> <span class="token operator">+</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 静态内部类，无法访问外部类的非静态成员变量和方法，防止内存泄漏
     */</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Inner</span> <span class="token punctuation">{</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;string: &quot;</span> <span class="token operator">+</span> STRING<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>这个类中，内部类 <code>Child</code> 因为没有定义为内部类，所以他可以访问外部类的静态和非静态变量、方法，不合理；而静态内部类 <code>Inner</code> 只能访问静态的变量和、方法，减少了内存泄露的可能性。</p> <h3 id="_5、hash-值改变"><a href="#_5、hash-值改变" class="header-anchor">#</a> 5、Hash 值改变</h3> <p>在集合中，如果修改了对象中的那些参与计算哈希值的字段，会导致无法从集合中单独删除当前对象，造成内存泄露。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> x<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> y<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 重写 hashCode() 方法
     *
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> prime <span class="token operator">=</span> <span class="token number">31</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        result <span class="token operator">=</span> prime <span class="token operator">*</span> result <span class="token operator">+</span> x<span class="token punctuation">;</span>
        result <span class="token operator">=</span> prime <span class="token operator">*</span> result <span class="token operator">+</span> y<span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 改变 y 的值：同时改变 hashCode()
     *
     * @param y
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setY</span><span class="token punctuation">(</span><span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">&gt;</span></span> hashSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Node</span> node1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Node</span> node2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>node1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>node2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// node2 的 Hash 值改变</span>
        node2<span class="token punctuation">.</span><span class="token function">setY</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 删掉 node2 节点</span>
        hashSet<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>node2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hashSet<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>执行结果：</p> <div class="language-console line-numbers-mode"><pre class="language-text"><code>2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>由于 <code>node2</code> 由于修改 <code>y</code> 属性导致更改了 <code>hash</code> 值，所以在 <code>remove()</code> 的时候没有正常移除掉。</p> <h2 id="三、内存泄露和内存溢出辨析"><a href="#三、内存泄露和内存溢出辨析" class="header-anchor">#</a> 三、内存泄露和内存溢出辨析</h2> <ul><li>相同与不同</li></ul> <p>内存溢出：实实在在的内存空间不足导致；</p> <p>内存泄漏：该释放的对象没有释放，多见于自己使用容器保存元素的情况下。</p> <ul><li>如何避免</li></ul> <p>内存溢出：检查代码以及设置足够的空间。</p> <p>内存泄漏：一定是代码有问题。往往很多情况下，内存溢出往往是内存泄漏造成的。</p> <h2 id="四、了解mat"><a href="#四、了解mat" class="header-anchor">#</a> 四、了解MAT</h2> <p><code>MAT</code> 是一个分析内存的工具，全名是 <code>EclipseMemoryAnalyzer</code>。</p> <p>先看下面这样一段代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DumpOom</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在方法执行的过程中，它是 GCRoots</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            i<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">10000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;i = &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>启动参数：<code>-Xms30m -Xmx30m -XX:+PrintGCDetails -XX:+HeapDumpOnOutOfMemoryError</code> ，其中 <code>-XX:+HeapDumpOnOutOfMemoryError</code> 表示将对内存溢出的信息导出来到当前项目根目录，执行结果：</p> <div class="language-console line-numbers-mode"><pre class="language-text"><code>i = 10000
i = 20000
i = 30000
...
i = 550000
i = 560000
i = 570000
[Full GC (Ergonomics) [PSYoungGen: 8192K-&gt;3070K(9216K)] [ParOldGen: 15132K-&gt;20086K(20480K)] 23324K-&gt;23156K(29696K), [Metaspace: 3217K-&gt;3217K(1056768K)], 0.0991477 secs] [Times: user=0.73 sys=0.02, real=0.10 secs] 
i = 580000
i = 590000
i = 600000
...
i = 700000
[Full GC (Ergonomics) [PSYoungGen: 8192K-&gt;8107K(9216K)] [ParOldGen: 20086K-&gt;20086K(20480K)] 28278K-&gt;28193K(29696K), [Metaspace: 3218K-&gt;3218K(1056768K)], 0.1849831 secs] [Times: user=1.75 sys=0.00, real=0.18 secs] 
[Full GC (Ergonomics) [PSYoungGen: 8192K-&gt;8191K(9216K)] [ParOldGen: 20086K-&gt;20086K(20480K)] 28278K-&gt;28278K(29696K), [Metaspace: 3218K-&gt;3218K(1056768K)], 0.1050623 secs] [Times: user=1.02 sys=0.00, real=0.11 secs]
...
[Full GC (Ergonomics) [PSYoungGen: 8192K-&gt;8192K(9216K)] [ParOldGen: 20116K-&gt;20116K(20480K)] 28308K-&gt;28308K(29696K), [Metaspace: 3228K-&gt;3228K(1056768K)], 0.1014891 secs] [Times: user=0.80 sys=0.00, real=0.10 secs] 
[Full GC (Ergonomics) [PSYoungGen: 8192K-&gt;8192K(9216K)] [ParOldGen: 20117K-&gt;20117K(20480K)] 28309K-&gt;28309K(29696K), [Metaspace: 3228K-&gt;3228K(1056768K)], 0.1011485 secs] [Times: user=1.03 sys=0.00, real=0.10 secs] 
java.lang.OutOfMemoryError: GC overhead limit exceeded
Dumping heap to java_pid1708.hprof ...
[Full GC (Ergonomics) [PSYoungGen: 8192K-&gt;8192K(9216K)] [ParOldGen: 20169K-&gt;20143K(20480K)] 28361K-&gt;28335K(29696K), [Metaspace: 3271K-&gt;3271K(1056768K)], 0.1089935 secs] [Times: user=1.09 sys=0.00, real=0.11 secs] 
Heap dump file created [53925809 bytes in 0.374 secs]
[Full GC (Ergonomics) [PSYoungGen: 8192K-&gt;8192K(9216K)] [ParOldGen: 20161K-&gt;20145K(20480K)] 28353K-&gt;28337K(29696K), [Metaspace: 3296K-&gt;3296K(1056768K)], 0.0974956 secs] [Times: user=0.94 sys=0.00, real=0.10 secs] 
[Full GC (Ergonomics) [PSYoungGen: 8192K-&gt;0K(9216K)] [ParOldGen: 20156K-&gt;641K(20480K)] 28348K-&gt;641K(29696K), [Metaspace: 3311K-&gt;3311K(1056768K)], 0.0037823 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
Heap
 PSYoungGen      total 9216K, used 387K [0x00000000ff600000, 0x0000000100000000, 0x0000000100000000)
  eden space 8192K, 4% used [0x00000000ff600000,0x00000000ff660ed0,0x00000000ffe00000)
  from space 1024K, 0% used [0x00000000fff00000,0x00000000fff00000,0x0000000100000000)
  to   space 1024K, 0% used [0x00000000ffe00000,0x00000000ffe00000,0x00000000fff00000)
 ParOldGen       total 20480K, used 641K [0x00000000fe200000, 0x00000000ff600000, 0x00000000ff600000)
  object space 20480K, 3% used [0x00000000fe200000,0x00000000fe2a07f0,0x00000000ff600000)
 Metaspace       used 3380K, capacity 4500K, committed 4864K, reserved 1056768K
  class space    used 363K, capacity 388K, committed 512K, reserved 1048576K
Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: GC overhead limit exceeded
	at java.util.LinkedList.linkLast(LinkedList.java:142)
	at java.util.LinkedList.add(LinkedList.java:338)
	at com.jerry.ch5.DumpOom.main(DumpOom.java:24)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>运行后，在根目录可以看到文件名类似这个的 <code>java_pid1708.hprof</code> ，使用 MAT 工具可以打开它。如图所示：</p> <p><img src="https://yjtravel-public.oss-cn-beijing.aliyuncs.com/my-blog/basic/mat.png" alt="mat"></p> <p>点击下面的 <code>Details</code> 还可以看详细的分析：</p> <p><img src="https://yjtravel-public.oss-cn-beijing.aliyuncs.com/my-blog/basic/mat2.png" alt="mat_detail"></p> <h3 id="_1、浅堆和深堆"><a href="#_1、浅堆和深堆" class="header-anchor">#</a> 1、浅堆和深堆</h3> <ul><li>浅堆（Shallow Heap）</li></ul> <p>是指一个对象所消耗的内存。例如，在 32 位系统中，一个对象引用会占据 4 个字节，一个 <code>int</code> 类型会占据 4 个字节，<code>long</code> 型变量会占据 8 个字节，每个对象头需要占用 8 个字节。</p> <ul><li>深堆（Retained Heap）</li></ul> <p>这个对象被 GC 回收后，可以真实释放的内存大小，也就是只能通过对象被直接或间接访问到的所有对象的集合。通俗地说，就是指仅被对象所持有的对象的集合。深堆是指对象的保留集中所有的对象的浅堆大小之和。</p> <p>举例：对象 <code>A</code> 引用了 <code>C</code> 和 <code>D</code>，对象 <code>B</code> 引用了 <code>E</code>。那么对象 <code>A</code> 的浅堆大小只是 <code>A</code> 本身，而如果 <code>A</code> 被回收，那么 <code>C</code> 和 <code>D</code> 都会被回收(可达性分析算法)，所以 <code>A</code> 的深堆大小为 <code>A + C + D</code> 之和，同时由于对象 <code>E</code> 还可以通过对象 <code>B</code> 访问到，因此不在对象 <code>A</code> 的深堆范围内。</p> <p><img src="https://yjtravel-public.oss-cn-beijing.aliyuncs.com/my-blog/basic/Retained_Heap.png" alt="浅堆和深堆"></p> <p>对于上面所讲的那个分析日志，当看到一个对象的神堆远远大于浅堆的时候就需要好好审查一下代码了。</p> <h3 id="_2、incoming-和-outgoing"><a href="#_2、incoming-和-outgoing" class="header-anchor">#</a> 2、incoming 和 outgoing</h3> <p>对象 <code>A</code> 引用了 <code>C</code> 和 <code>D</code>，那么 <code>A</code> 就是 <code>C</code> 和 <code>D</code> 的 <code>incoming</code>，相反的 <code>C</code> 和 <code>D</code> 就是 <code>A</code> 的 <code>outgoing</code></p> <h2 id="五、jdk为我们提供的工具"><a href="#五、jdk为我们提供的工具" class="header-anchor">#</a> 五、JDK为我们提供的工具</h2> <h3 id="_1、命令行工具"><a href="#_1、命令行工具" class="header-anchor">#</a> 1、命令行工具</h3> <h4 id="_1-jps"><a href="#_1-jps" class="header-anchor">#</a> (1) jps</h4> <p>列出当前机器上正在运行的虚拟机进程，<code>JPS</code> 从操作系统的临时目录上去找。</p> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td>-q</td> <td>仅仅显示进程</td></tr> <tr><td>-m</td> <td>输出主函数传入的参数</td></tr> <tr><td>-l</td> <td>输出应用程序主类完整 <code>package</code> 名称或 <code>jar</code> 完整名称</td></tr> <tr><td>-v</td> <td>列出 <code>jvm</code> 参数</td></tr></tbody></table> <h4 id="_2-jstat"><a href="#_2-jstat" class="header-anchor">#</a> (2) jstat</h4> <p>是用于监视虚拟机各种运行状态信息的命令行工具。它可以显示本地或者远程虚拟机进程中的类装载、内存、垃圾收集、<code>JIT</code> 编译等运行数据，在没有 <code>GUI</code> 图形界面，只提供了纯文本控制台环境的服务器上，它将是运行期定位虚拟机性能问题的首选工具。</p> <p>假设需要每 250 毫秒查询一次进程 13616 垃圾收集状况，一共查询 10 次，那命令应当是：<code>jstat -gc 13616 250 10</code></p> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td>-class</td> <td>类加载器</td></tr> <tr><td>-compiler</td> <td><code>JIT</code></td></tr> <tr><td>-gc</td> <td><code>GC</code> 堆状态</td></tr> <tr><td>-gccapacity</td> <td>各区大小</td></tr> <tr><td>-gccause</td> <td>最近一次 <code>GC</code> 统计和原因</td></tr> <tr><td>-gcnew</td> <td>新区统计</td></tr> <tr><td>-gcnewcapacity</td> <td>新区大小</td></tr> <tr><td>-gcold</td> <td>老区统计</td></tr> <tr><td>-gcoldcapacity</td> <td>老区大小</td></tr> <tr><td>-gcpermcapacity</td> <td>永久区大小</td></tr> <tr><td>-gcutil</td> <td><code>GC</code> 统计汇总</td></tr> <tr><td>-printcompilation</td> <td><code>HotSpot</code> 编译统计</td></tr></tbody></table> <h4 id="_3-jinfo"><a href="#_3-jinfo" class="header-anchor">#</a> (3) jinfo</h4> <p>查看和修改虚拟机的参数。</p> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td>–sysprops</td> <td>可以查看由 System.getProperties()取得的参数</td></tr> <tr><td>–flag</td> <td>未被显式指定的参数的系统默认值</td></tr> <tr><td>–flags</td> <td>显示虚拟机的参数</td></tr> <tr><td>–flag +[参数]</td> <td>可以增加参数，但是仅限于由 <code>java -XX:+PrintFlagsFinal –version</code> 查询出来且为 <code>manageable</code> 的参数</td></tr> <tr><td>–flag -[参数]</td> <td>可以去除参数</td></tr></tbody></table> <p>看下面这段代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JInfoTest</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 填充数据，造成 GC
     *
     * @param args
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>启动参数：<code>-Xms20m -Xmx20m -Xmn2m -XX:+PrintGC</code>，执行结果：</p> <div class="language-console line-numbers-mode"><pre class="language-text"><code>[GC (Allocation Failure)  1024K-&gt;600K(19968K), 0.0010100 secs]
[GC (Allocation Failure)  11862K-&gt;10968K(19968K), 0.0009586 secs]
[GC (Allocation Failure)  18984K-&gt;18520K(19968K), 0.0009448 secs]
[Full GC (Ergonomics)  18520K-&gt;2014K(19968K), 0.0067019 secs]
[GC (Allocation Failure)  18419K-&gt;18398K(19968K), 0.0004530 secs]
[Full GC (Ergonomics)  18398K-&gt;2013K(19968K), 0.0066805 secs]
[GC (Allocation Failure)  18398K-&gt;18398K(19968K), 0.0008508 secs]
[Full GC (Ergonomics)  18398K-&gt;1961K(19968K), 0.0140619 secs]
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>起初的执行结果就这么多，此时通过命令：<code>jps</code> 查询到当前运行的进程是11056：</p> <p><img src="https://yjtravel-public.oss-cn-beijing.aliyuncs.com/my-blog/basic/jps.png" alt="jps命令"></p> <p>然后执行命令：<code>jinfo -flag +PrintGCDetails 11056</code> 执行后，可以看到控制台的输出日志多了这些内容：</p> <div class="language-console line-numbers-mode"><pre class="language-text"><code>...
[GC (Allocation Failure) [PSYoungGen: 0K-&gt;0K(1536K)] 17408K-&gt;17408K(19968K), 0.0253200 secs] [Times: user=0.00 sys=0.00, real=0.02 secs] 
[GC (Allocation Failure) [PSYoungGen: 0K-&gt;0K(1536K)] 17408K-&gt;17408K(19968K), 0.0003467 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
[Full GC (Allocation Failure) [PSYoungGen: 0K-&gt;0K(1536K)] [ParOldGen: 17408K-&gt;2048K(18432K)] 17408K-&gt;2048K(19968K), [Metaspace: 3993K-&gt;3993K(1056768K)], 0.0024827 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这样就动态修改了启动参数名实时监控到了变化的日志内容。</p> <h4 id="_4-jmap"><a href="#_4-jmap" class="header-anchor">#</a> (4) jmap</h4> <p>用于生成堆转储快照（一般称为 <code>heapdump</code> 或 <code>dump</code> 文件）。<code>jmap</code> 的作用并不仅仅是为了获取 <code>dump</code> 文件，它还可以查询 <code>finalize</code> 执行队列、<code>Java</code> 堆和永久代的详细信息，如空间使用率、当前用的是哪种收集器等。和 <code>jinfo</code> 命令一样，<code>jmap</code> 有不少功能在 <code>Windows</code> 平台下都是受限的，除了生成 <code>dump</code> 文件的</p> <table><thead><tr><th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td>-dump</td> <td>用于查看每个类的实例、空间占用的统计</td></tr></tbody></table> <p>例如，命令 <code>jmap -dump:live,format=b,file=heap.bin &lt;pid&gt;</code> 可以将生成的日志保存当前用户目录下。</p> <p><img src="https://yjtravel-public.oss-cn-beijing.aliyuncs.com/my-blog/basic/jmap.png" alt="jmap命令"></p> <h4 id="_5-jhat"><a href="#_5-jhat" class="header-anchor">#</a> (5) jhat</h4> <p>使用 <code>jhat 文件名</code> 可以查看刚才生成的日志文件。</p> <p><img src="https://yjtravel-public.oss-cn-beijing.aliyuncs.com/my-blog/basic/jhat.png" alt="jhat命令"></p> <p>执行后屏幕显示“Server is ready.”的提示后，用户在浏览器中键入 <a href="http://localhost:7000/" target="_blank" rel="noopener noreferrer">http://localhost:7000/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 就可以访问详情</p> <h4 id="_6-jstack"><a href="#_6-jstack" class="header-anchor">#</a> (6) jstack</h4> <p>（<code>Stack Trace for Java</code>）命令用于生成虚拟机当前时刻的线程快照。线程快照就是当前虚拟机内每一条线程正在执行的方法堆栈的集合，生成线程快照的主要目的是定位线程出现长时间停顿的原因，如线程间死锁、死循环、请求外部资源导致的长时间等待等都是导致线程长时间停顿的常见原因。</p> <p>在代码中可以用 <code>java.lang.Thread</code> 类的 <code>getAllStackTraces()</code> 方法用于获取虚拟机中所有线程的 <code>StackTraceElement</code> 对象。使用这个方法可以通过简单的几行代码就完成 <code>jstack</code> 的大部分功能，在实际项目中不妨调用这个方法做个管理员页面，可以随时使用浏览器来查看线程堆栈。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AllStackTraces</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 填充数据，造成GC
     *
     * @param args
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 于获取虚拟机中所有线程的 StackTraceElement 对象</span>
            <span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">,</span> <span class="token class-name">StackTraceElement</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> threadMap <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">getAllStackTraces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token class-name">Entry</span><span class="token operator">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">,</span> <span class="token class-name">StackTraceElement</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> entry <span class="token operator">:</span> threadMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span> t <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">StackTraceElement</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ss <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 打印线程信息</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> t<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 打印线程详情信息</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">StackTraceElement</span> s <span class="token operator">:</span> ss<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>启动参数：<code>-Xms20m -Xmx20m -Xmn2m -XX:+PrintGC</code>，执行结果：</p> <div class="language-console line-numbers-mode"><pre class="language-text"><code>[GC (Allocation Failure)  1024K-&gt;576K(19968K), 0.0009532 secs]
[GC (Allocation Failure)  11835K-&gt;10976K(19968K), 0.0013425 secs]
Finalizer-3
java.lang.Object.wait(Native Method)
java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143)
java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164)
java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)
main-1
java.lang.Thread.dumpThreads(Native Method)
java.lang.Thread.getAllStackTraces(Thread.java:1607)
com.jerry.ch5.AllStackTraces.main(AllStackTraces.java:31)
Monitor Ctrl-Break-6
java.net.SocketInputStream.socketRead0(Native Method)
java.net.SocketInputStream.socketRead(SocketInputStream.java:116)
java.net.SocketInputStream.read(SocketInputStream.java:171)
java.net.SocketInputStream.read(SocketInputStream.java:141)
sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:284)
sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326)
sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178)
java.io.InputStreamReader.read(InputStreamReader.java:184)
java.io.BufferedReader.fill(BufferedReader.java:161)
java.io.BufferedReader.readLine(BufferedReader.java:324)
java.io.BufferedReader.readLine(BufferedReader.java:389)
com.intellij.rt.execution.application.AppMainV2$1.run(AppMainV2.java:64)
Attach Listener-5
Signal Dispatcher-4
Reference Handler-2
java.lang.Object.wait(Native Method)
java.lang.Object.wait(Object.java:502)
java.lang.ref.Reference.tryHandlePending(Reference.java:191)
java.lang.ref.Reference$ReferenceHandler.run(Reference.java:153)
[GC (Allocation Failure)  19033K-&gt;18468K(19968K), 0.0008729 secs]
[Full GC (Ergonomics)  18468K-&gt;2016K(19968K), 0.0053061 secs]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="_2、可视化工具"><a href="#_2、可视化工具" class="header-anchor">#</a> 2、可视化工具</h3> <p><code>JMX</code>（<code>Java Management Extensions</code>，即 Java 管理扩展）是一个为应用程序、设备、系统等植入管理功能的框架。<code>JMX</code> 可以跨越一系列异构操作系统平台、系统体系结构和网络传输协议，灵活的开发无缝集成的系统、网络和服务管理应用。</p> <h4 id="_1-jconsole"><a href="#_1-jconsole" class="header-anchor">#</a> (1) jconsole</h4> <p>一种基于 <code>JMX</code> 的可视化监视、管理工具。</p> <p>运行后可以选择之前保存的 <code>heap.bin</code> 文件</p> <p><img src="https://yjtravel-public.oss-cn-beijing.aliyuncs.com/my-blog/basic/jconsole.png" alt="jconsole"></p> <p>可以查看内存等使用情况：</p> <p><img src="https://yjtravel-public.oss-cn-beijing.aliyuncs.com/my-blog/basic/jconsole2.png" alt="jconsole2"></p> <h4 id="_2-visualvm"><a href="#_2-visualvm" class="header-anchor">#</a> (2) VisualVM</h4> <p><code>VisualVM</code> 是一个集成多个 <code>JDK</code> 命令行工具的可视化工具。可以作为 <code>Java应</code> 用程序性能分析和运行监控的工具。开发人员可以利用它来监控、分析线程信息，浏览内存堆数据。系统管理员可以利用它来监测、控制 <code>Java</code> 应用程序横跨整个网络的情况。<code>Java</code> 应用程序使用人员可以利用它来创建包含所有必要信息的 <code>Bug</code> 报告。</p> <p>插件中心地址 <a href="https://visualvm.github.io" target="_blank" rel="noopener noreferrer">https://visualvm.github.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div><br> <div id="vcomments"></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020-08-21 09:02:51（10 小时前）</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/my-blog/backend/JVM执行子系统.html" class="prev">
        JVM执行子系统
      </a></span> <span class="next"><a href="/my-blog/backend/MySQL安装和基础数据类型.html">
        MySQL安装和基础数据类型
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/my-blog/assets/js/app.11c55fdf.js" defer></script><script src="/my-blog/assets/js/2.f643b0a2.js" defer></script><script src="/my-blog/assets/js/14.ca26e948.js" defer></script><script src="/my-blog/assets/js/4.fd36f240.js" defer></script><script src="/my-blog/assets/js/5.628d6842.js" defer></script>
  </body>
</html>
