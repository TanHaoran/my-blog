<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL体系架构 | 林山夕风</title>
    <meta name="description" content="林山夕风的博客,md文档,技术博客">
    <meta name="generator" content="VuePress 1.3.0">
    <link rel="icon" href="/my-blog/avatar.jpg">
  <script>
                var _hmt = _hmt || [];
                (function() {
                    var hm = document.createElement("script");
                    hm.src = "https://hm.baidu.com/hm.js?68e7a949df184c1e4c82b115461e51e0";
                    var s = document.getElementsByTagName("script")[0];
                    s.parentNode.insertBefore(hm, s);
                })();
            </script>
    
    <link rel="preload" href="/my-blog/assets/css/0.styles.67b6080f.css" as="style"><link rel="preload" href="/my-blog/assets/js/app.11c55fdf.js" as="script"><link rel="preload" href="/my-blog/assets/js/2.f643b0a2.js" as="script"><link rel="preload" href="/my-blog/assets/js/23.f9133433.js" as="script"><link rel="preload" href="/my-blog/assets/js/4.fd36f240.js" as="script"><link rel="preload" href="/my-blog/assets/js/5.628d6842.js" as="script"><link rel="prefetch" href="/my-blog/assets/js/10.f4eaa613.js"><link rel="prefetch" href="/my-blog/assets/js/100.07e38629.js"><link rel="prefetch" href="/my-blog/assets/js/101.dcfe2bf2.js"><link rel="prefetch" href="/my-blog/assets/js/102.209999b3.js"><link rel="prefetch" href="/my-blog/assets/js/103.a9a85d34.js"><link rel="prefetch" href="/my-blog/assets/js/104.fdefe1dc.js"><link rel="prefetch" href="/my-blog/assets/js/105.e4b5d0af.js"><link rel="prefetch" href="/my-blog/assets/js/106.cf83f84b.js"><link rel="prefetch" href="/my-blog/assets/js/107.848b42d5.js"><link rel="prefetch" href="/my-blog/assets/js/108.351fb64c.js"><link rel="prefetch" href="/my-blog/assets/js/109.4b9111f6.js"><link rel="prefetch" href="/my-blog/assets/js/11.5d5723d1.js"><link rel="prefetch" href="/my-blog/assets/js/110.7f24fb6a.js"><link rel="prefetch" href="/my-blog/assets/js/111.28300395.js"><link rel="prefetch" href="/my-blog/assets/js/112.839af357.js"><link rel="prefetch" href="/my-blog/assets/js/113.67de001a.js"><link rel="prefetch" href="/my-blog/assets/js/114.408ea2f6.js"><link rel="prefetch" href="/my-blog/assets/js/115.34a1d81a.js"><link rel="prefetch" href="/my-blog/assets/js/116.f510ca2c.js"><link rel="prefetch" href="/my-blog/assets/js/117.24ddf316.js"><link rel="prefetch" href="/my-blog/assets/js/12.06fcb150.js"><link rel="prefetch" href="/my-blog/assets/js/13.c441de9d.js"><link rel="prefetch" href="/my-blog/assets/js/14.ca26e948.js"><link rel="prefetch" href="/my-blog/assets/js/15.e7761bd0.js"><link rel="prefetch" href="/my-blog/assets/js/16.5be4d33f.js"><link rel="prefetch" href="/my-blog/assets/js/17.4426a95c.js"><link rel="prefetch" href="/my-blog/assets/js/18.7d974f8d.js"><link rel="prefetch" href="/my-blog/assets/js/19.775995bc.js"><link rel="prefetch" href="/my-blog/assets/js/20.71c35e12.js"><link rel="prefetch" href="/my-blog/assets/js/21.741a18a7.js"><link rel="prefetch" href="/my-blog/assets/js/22.819a7e85.js"><link rel="prefetch" href="/my-blog/assets/js/24.86a7d541.js"><link rel="prefetch" href="/my-blog/assets/js/25.0aa2d6ab.js"><link rel="prefetch" href="/my-blog/assets/js/26.3e55392e.js"><link rel="prefetch" href="/my-blog/assets/js/27.ae2e0581.js"><link rel="prefetch" href="/my-blog/assets/js/28.aaa62b88.js"><link rel="prefetch" href="/my-blog/assets/js/29.55007ae9.js"><link rel="prefetch" href="/my-blog/assets/js/3.57915124.js"><link rel="prefetch" href="/my-blog/assets/js/30.63aac023.js"><link rel="prefetch" href="/my-blog/assets/js/31.d5607214.js"><link rel="prefetch" href="/my-blog/assets/js/32.a7ae912b.js"><link rel="prefetch" href="/my-blog/assets/js/33.58fcbfa4.js"><link rel="prefetch" href="/my-blog/assets/js/34.8538d781.js"><link rel="prefetch" href="/my-blog/assets/js/35.14a82428.js"><link rel="prefetch" href="/my-blog/assets/js/36.2ad806dd.js"><link rel="prefetch" href="/my-blog/assets/js/37.207a29ce.js"><link rel="prefetch" href="/my-blog/assets/js/38.57c0d12e.js"><link rel="prefetch" href="/my-blog/assets/js/39.83aff8a9.js"><link rel="prefetch" href="/my-blog/assets/js/40.bcbcfd03.js"><link rel="prefetch" href="/my-blog/assets/js/41.d0a94dfd.js"><link rel="prefetch" href="/my-blog/assets/js/42.f6011b50.js"><link rel="prefetch" href="/my-blog/assets/js/43.efd29b4c.js"><link rel="prefetch" href="/my-blog/assets/js/44.e5c9709c.js"><link rel="prefetch" href="/my-blog/assets/js/45.7656da3c.js"><link rel="prefetch" href="/my-blog/assets/js/46.0f46c833.js"><link rel="prefetch" href="/my-blog/assets/js/47.40ce4540.js"><link rel="prefetch" href="/my-blog/assets/js/48.3db9c583.js"><link rel="prefetch" href="/my-blog/assets/js/49.53285ac3.js"><link rel="prefetch" href="/my-blog/assets/js/50.4db56f99.js"><link rel="prefetch" href="/my-blog/assets/js/51.188f8c4f.js"><link rel="prefetch" href="/my-blog/assets/js/52.95be221e.js"><link rel="prefetch" href="/my-blog/assets/js/53.276e1791.js"><link rel="prefetch" href="/my-blog/assets/js/54.2fd73796.js"><link rel="prefetch" href="/my-blog/assets/js/55.c90a5bd8.js"><link rel="prefetch" href="/my-blog/assets/js/56.406f89df.js"><link rel="prefetch" href="/my-blog/assets/js/57.811f05ab.js"><link rel="prefetch" href="/my-blog/assets/js/58.e2896a54.js"><link rel="prefetch" href="/my-blog/assets/js/59.e5f3be54.js"><link rel="prefetch" href="/my-blog/assets/js/6.8ba90f8e.js"><link rel="prefetch" href="/my-blog/assets/js/60.e4b67c15.js"><link rel="prefetch" href="/my-blog/assets/js/61.7b772903.js"><link rel="prefetch" href="/my-blog/assets/js/62.bbe4352b.js"><link rel="prefetch" href="/my-blog/assets/js/63.e350ef3b.js"><link rel="prefetch" href="/my-blog/assets/js/64.7b6ca2f6.js"><link rel="prefetch" href="/my-blog/assets/js/65.76baf7fa.js"><link rel="prefetch" href="/my-blog/assets/js/66.ff801cea.js"><link rel="prefetch" href="/my-blog/assets/js/67.ee30cd5b.js"><link rel="prefetch" href="/my-blog/assets/js/68.0f4c1ce2.js"><link rel="prefetch" href="/my-blog/assets/js/69.111ce4de.js"><link rel="prefetch" href="/my-blog/assets/js/7.55078740.js"><link rel="prefetch" href="/my-blog/assets/js/70.46f8b5e8.js"><link rel="prefetch" href="/my-blog/assets/js/71.675e279c.js"><link rel="prefetch" href="/my-blog/assets/js/72.c419d947.js"><link rel="prefetch" href="/my-blog/assets/js/73.6eb4799a.js"><link rel="prefetch" href="/my-blog/assets/js/74.18229d2e.js"><link rel="prefetch" href="/my-blog/assets/js/75.46c8298d.js"><link rel="prefetch" href="/my-blog/assets/js/76.c966d3c5.js"><link rel="prefetch" href="/my-blog/assets/js/77.b31efc9c.js"><link rel="prefetch" href="/my-blog/assets/js/78.f7e57735.js"><link rel="prefetch" href="/my-blog/assets/js/79.e056b5a5.js"><link rel="prefetch" href="/my-blog/assets/js/8.ddecccf2.js"><link rel="prefetch" href="/my-blog/assets/js/80.0fc539d1.js"><link rel="prefetch" href="/my-blog/assets/js/81.2b7f0d10.js"><link rel="prefetch" href="/my-blog/assets/js/82.d3e4b716.js"><link rel="prefetch" href="/my-blog/assets/js/83.3073a1d2.js"><link rel="prefetch" href="/my-blog/assets/js/84.d231aeff.js"><link rel="prefetch" href="/my-blog/assets/js/85.7daed020.js"><link rel="prefetch" href="/my-blog/assets/js/86.0c8d8d8e.js"><link rel="prefetch" href="/my-blog/assets/js/87.c4ba5f03.js"><link rel="prefetch" href="/my-blog/assets/js/88.9a4e0ef6.js"><link rel="prefetch" href="/my-blog/assets/js/89.b7bca56b.js"><link rel="prefetch" href="/my-blog/assets/js/9.7463f385.js"><link rel="prefetch" href="/my-blog/assets/js/90.49ec4345.js"><link rel="prefetch" href="/my-blog/assets/js/91.84cb7a66.js"><link rel="prefetch" href="/my-blog/assets/js/92.cb5ea946.js"><link rel="prefetch" href="/my-blog/assets/js/93.05e2ac79.js"><link rel="prefetch" href="/my-blog/assets/js/94.e60969c0.js"><link rel="prefetch" href="/my-blog/assets/js/95.688af442.js"><link rel="prefetch" href="/my-blog/assets/js/96.aba3a873.js"><link rel="prefetch" href="/my-blog/assets/js/97.ca8196eb.js"><link rel="prefetch" href="/my-blog/assets/js/98.071b3a0f.js"><link rel="prefetch" href="/my-blog/assets/js/99.eca50447.js">
    <link rel="stylesheet" href="/my-blog/assets/css/0.styles.67b6080f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-blog/" class="home-link router-link-active"><!----> <span class="site-name">林山夕风</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础教程" class="dropdown-title"><span class="title">基础教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/frontend/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/backend/" class="nav-link router-link-active">
  后端
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/enjoy3/" class="nav-link">
  进阶
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据结构与算法" class="dropdown-title"><span class="title">数据结构与算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/structure/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/algorithm/" class="nav-link">
  算法
</a></li></ul></div></div><div class="nav-item"><a href="/my-blog/leetcode/" class="nav-link">
  LeetCode题解
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计思想" class="dropdown-title"><span class="title">设计思想</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/principle/" class="nav-link">
  设计原则
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/pattern/" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="读书笔记" class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/thinking_in_java/" class="nav-link">
  Java编程思想
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/refactoring_improving_the_design_of_existing_code/" class="nav-link">
  重构改善既有代码的设计
</a></li></ul></div></div><div class="nav-item"><a href="/my-blog/project/" class="nav-link">
  项目实战
</a></div><div class="nav-item"><a href="/my-blog/article/" class="nav-link">
  零散文章
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码管理" class="dropdown-title"><span class="title">代码管理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/doomthr" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/TanHaoran" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/my-blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础教程" class="dropdown-title"><span class="title">基础教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/frontend/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/backend/" class="nav-link router-link-active">
  后端
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/enjoy3/" class="nav-link">
  进阶
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据结构与算法" class="dropdown-title"><span class="title">数据结构与算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/structure/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/algorithm/" class="nav-link">
  算法
</a></li></ul></div></div><div class="nav-item"><a href="/my-blog/leetcode/" class="nav-link">
  LeetCode题解
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计思想" class="dropdown-title"><span class="title">设计思想</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/principle/" class="nav-link">
  设计原则
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/pattern/" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="读书笔记" class="dropdown-title"><span class="title">读书笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/my-blog/thinking_in_java/" class="nav-link">
  Java编程思想
</a></li><li class="dropdown-item"><!----> <a href="/my-blog/refactoring_improving_the_design_of_existing_code/" class="nav-link">
  重构改善既有代码的设计
</a></li></ul></div></div><div class="nav-item"><a href="/my-blog/project/" class="nav-link">
  项目实战
</a></div><div class="nav-item"><a href="/my-blog/article/" class="nav-link">
  零散文章
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码管理" class="dropdown-title"><span class="title">代码管理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/doomthr" target="_blank" rel="noopener noreferrer" class="nav-link external">
  码云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/TanHaoran" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基础教程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/my-blog/backend/线程基础.html" class="sidebar-link">线程基础</a></li><li><a href="/my-blog/backend/线程之间的共享和协作.html" class="sidebar-link">线程之间的共享和协作</a></li><li><a href="/my-blog/backend/线程的并发工具类.html" class="sidebar-link">线程的并发工具类</a></li><li><a href="/my-blog/backend/原子操作CAS.html" class="sidebar-link">原子操作CAS</a></li><li><a href="/my-blog/backend/显示锁和AQS.html" class="sidebar-link">显示锁和AQS</a></li><li><a href="/my-blog/backend/并发容器.html" class="sidebar-link">并发容器</a></li><li><a href="/my-blog/backend/线程池.html" class="sidebar-link">线程池</a></li><li><a href="/my-blog/backend/并发安全.html" class="sidebar-link">并发安全</a></li><li><a href="/my-blog/backend/JMM和底层实现原理.html" class="sidebar-link">JMM和底层实现原理</a></li><li><a href="/my-blog/backend/Java8新增的并发.html" class="sidebar-link">Java8新增的并发</a></li><li><a href="/my-blog/backend/常见并发面试题.html" class="sidebar-link">常见并发面试题</a></li><li><a href="/my-blog/backend/深入理解JVM内存区域.html" class="sidebar-link">深入理解JVM内存区域</a></li><li><a href="/my-blog/backend/JVM如何创建对象.html" class="sidebar-link">JVM如何创建对象</a></li><li><a href="/my-blog/backend/垃圾回收算法与垃圾回收器.html" class="sidebar-link">垃圾回收算法与垃圾回收器</a></li><li><a href="/my-blog/backend/JVM执行子系统.html" class="sidebar-link">JVM执行子系统</a></li><li><a href="/my-blog/backend/JVM性能优化.html" class="sidebar-link">JVM性能优化</a></li><li><a href="/my-blog/backend/MySQL安装和基础数据类型.html" class="sidebar-link">MySQL安装和基础数据类型</a></li><li><a href="/my-blog/backend/MySQL体系架构.html" class="active sidebar-link">MySQL体系架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-blog/backend/MySQL体系架构.html#一、体系" class="sidebar-link">一、体系</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-blog/backend/MySQL体系架构.html#_1、连接层" class="sidebar-link">1、连接层</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/MySQL体系架构.html#_2、sql处理层" class="sidebar-link">2、SQL处理层</a></li></ul></li><li class="sidebar-sub-header"><a href="/my-blog/backend/MySQL体系架构.html#二、逻辑架构" class="sidebar-link">二、逻辑架构</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/MySQL体系架构.html#三、物理存储结构" class="sidebar-link">三、物理存储结构</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/MySQL体系架构.html#四、存储引擎" class="sidebar-link">四、存储引擎</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-blog/backend/MySQL体系架构.html#_1、myisam" class="sidebar-link">1、MyISAM</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/MySQL体系架构.html#_2、innodb" class="sidebar-link">2、Innodb</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/MySQL体系架构.html#_3、csv" class="sidebar-link">3、CSV</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/MySQL体系架构.html#_4、archive" class="sidebar-link">4、Archive</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/MySQL体系架构.html#_5、memory" class="sidebar-link">5、Memory</a></li><li class="sidebar-sub-header"><a href="/my-blog/backend/MySQL体系架构.html#_6、ferderated" class="sidebar-link">6、Ferderated</a></li></ul></li></ul></li><li><a href="/my-blog/backend/MySQL锁与事务的分析.html" class="sidebar-link">MySQL锁与事务的分析</a></li><li><a href="/my-blog/backend/MySQL业务设计.html" class="sidebar-link">MySQL业务设计</a></li><li><a href="/my-blog/backend/MySQL慢查询.html" class="sidebar-link">MySQL慢查询</a></li><li><a href="/my-blog/backend/MySQL索引和执行计划.html" class="sidebar-link">MySQL索引和执行计划</a></li><li><a href="/my-blog/backend/MySQL的SQL优化.html" class="sidebar-link">MySQL的SQL优化</a></li><li><a href="/my-blog/backend/Linux基础.html" class="sidebar-link">Linux基础</a></li><li><a href="/my-blog/backend/反射：框架设计的灵魂.html" class="sidebar-link">反射：框架设计的灵魂</a></li><li><a href="/my-blog/backend/Java8新增特性.html" class="sidebar-link">Java8新增特性</a></li><li><a href="/my-blog/backend/MyBatis应用.html" class="sidebar-link">MyBatis应用</a></li><li><a href="/my-blog/backend/MyBatis源码骨架分析.html" class="sidebar-link">MyBatis源码骨架分析</a></li><li><a href="/my-blog/backend/MyBatis源码流程分析.html" class="sidebar-link">MyBatis源码流程分析</a></li><li><a href="/my-blog/backend/消息中间件入门，AMQP与RabbitMQ.html" class="sidebar-link">消息中间件入门，AMQP与RabbitMQ</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql体系架构"><a href="#mysql体系架构" class="header-anchor">#</a> MySQL体系架构</h1> <div><span id="/my-blog/backend/MySQL体系架构.html" data-flag-title="MySQL体系架构" class="leancloud_visitors read-count"><em class="post-meta-item-text">阅读量 </em> <i class="leancloud-visitors-count">loading</i></span> <div class="clear-both"></div></div> <h2 id="一、体系"><a href="#一、体系" class="header-anchor">#</a> 一、体系</h2> <h3 id="_1、连接层"><a href="#_1、连接层" class="header-anchor">#</a> 1、连接层</h3> <p>当 MySQL 启动（MySQL 服务器就是一个进程），等待客户端连接，每一个客户端连接请求，服务器都会新建一个线程处理（如果是线程池的话，则是分配一个空的线程），每个线程独立，拥有各自的内存处理空间。</p> <h3 id="_2、sql处理层"><a href="#_2、sql处理层" class="header-anchor">#</a> 2、SQL处理层</h3> <h4 id="_1-缓存"><a href="#_1-缓存" class="header-anchor">#</a> (1) 缓存</h4> <p>查询是否开启缓存：<code>SELECT @@query_cache_type</code></p> <p>查询缓存的大小：<code>SELECT	@@query_cache_size</code></p> <h4 id="_2-解析查询"><a href="#_2-解析查询" class="header-anchor">#</a> (2) 解析查询</h4> <p>一个 <code>sql</code> 语句通常如下：</p> <p><img src="https://yjtravel-public.oss-cn-beijing.aliyuncs.com/my-blog/basic/mysql.png" alt="sql语句"></p> <p>实际的解析顺序如下：</p> <p><img src="https://yjtravel-public.oss-cn-beijing.aliyuncs.com/my-blog/basic/mysql2.png" alt="sql解析"></p> <h4 id="_3-优化"><a href="#_3-优化" class="header-anchor">#</a> (3) 优化</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> account <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">''</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>观察执行计划的 <code>Extra</code> 字段是：<code>Using where</code>，说明这个 <code>sql</code> 语句使用到了 <code>where</code> 语句查询。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> account <span class="token keyword">WHERE</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>此时 <code>Extra</code> 字段是空的，说明这里虽然写了 <code>WHERE 1 = 1</code>，但是实际上并不是一个真正的 <code>where</code> 语句查询。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> account <span class="token keyword">WHERE</span> id <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>此时 <code>Extra</code> 字段是：<code>Impossible WHERE</code>，因为主键 <code>id</code> 是不可能为 <code>null</code> 的，所以这里是一个不可能的 <code>WHERE</code> 语句查询。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> account t <span class="token keyword">WHERE</span> t<span class="token punctuation">.</span>id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> t2<span class="token punctuation">.</span>id <span class="token keyword">FROM</span> account t2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行上面这个语句会产生一条 <code>warning</code> ，使用 <code>SHOW warnings</code> 可以看出，它提示我们的上面的 <code>sql</code> 其实和下面这个 <code>sql</code> 的是等价的：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
	t<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
	t<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
	t<span class="token punctuation">.</span>balance 
<span class="token keyword">FROM</span>
	account t
	<span class="token keyword">JOIN</span> account t2 
<span class="token keyword">WHERE</span>
	t<span class="token punctuation">.</span>id <span class="token operator">=</span> t2<span class="token punctuation">.</span>id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="二、逻辑架构"><a href="#二、逻辑架构" class="header-anchor">#</a> 二、逻辑架构</h2> <p>在 <code>mysql</code> 中其实还有个 <code>schema</code> 的概念，这概念没什么太多作用，只是为了兼容其他数据库，所以也提出了这个。在 <code>mysql</code> 中 <code>database</code> 和 <code>schema</code> 是等价的。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> demo<span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">SCHEMA</span> demo<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>使用 <code>DATABASE</code> 创建的库，使用 <code>SCHEMA</code> 来删除也会将库删除。</p> <h2 id="三、物理存储结构"><a href="#三、物理存储结构" class="header-anchor">#</a> 三、物理存储结构</h2> <p>使用这个命令可以看到 <code>mysql</code> 数据都存在哪里：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'datadir'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>进入这个路径后，可以看出，这里面存了一个个文件夹，是和数据库的名字是一一对应的。再进入每一个文件夹，每一张表都对应一个 <code>.frm</code> 和 <code>.ibd</code> 文件。</p> <p><code>.frm</code> 就是表结构文件，<code>.ibd</code> 表是的使用 <code>innoDB</code> 引擎创建的表。</p> <p>如果想看到 <code>.frm</code> 的文件内容，需要安装一个工具：<code>mysql-utilities</code>，下面是安装步骤：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">tar</span> -zxvf mysql-utilities-1.6.5.tar.gz
<span class="token builtin class-name">cd</span> mysql-utilities-1.6.5
python ./setup.py build
python ./setup.py <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>安装完成后，就可以使用命令查看 <code>.frm</code> 文件了：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysqlfrm --diagnostic /usr/local/mysql/data/mall/account.frm
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行结果：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># WARNING: Cannot generate character set or collation names without the --server option.</span>
<span class="token comment"># CAUTION: The diagnostic mode is a best-effort parse of the .frm file. As such, it may not identify all of the components of the table correctly. This is especially true for damaged files. It will also not read the default values for the columns and the resulting statement may not be syntactically correct.</span>
<span class="token comment"># Reading .frm file for /usr/local/mysql/data/mall/account.frm:</span>
<span class="token comment"># The .frm file is a TABLE.</span>
<span class="token comment"># CREATE TABLE Statement:</span>

CREATE TABLE <span class="token variable"><span class="token variable">`</span>mall<span class="token variable">`</span></span><span class="token builtin class-name">.</span><span class="token variable"><span class="token variable">`</span>account<span class="token variable">`</span></span> <span class="token punctuation">(</span>
  <span class="token variable"><span class="token variable">`</span><span class="token function">id</span><span class="token variable">`</span></span> int<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> NOT NULL, 
  <span class="token variable"><span class="token variable">`</span>name<span class="token variable">`</span></span> varchar<span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span> DEFAULT NULL, 
  <span class="token variable"><span class="token variable">`</span>balance<span class="token variable">`</span></span> int<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> DEFAULT NULL, 
PRIMARY KEY <span class="token variable"><span class="token variable">`</span>PRIMARY<span class="token variable">`</span></span> <span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span><span class="token function">id</span><span class="token variable">`</span></span><span class="token punctuation">)</span>,
KEY <span class="token variable"><span class="token variable">`</span>idx_balance<span class="token variable">`</span></span> <span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>balance<span class="token variable">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token assign-left variable">ENGINE</span><span class="token operator">=</span>InnoDB<span class="token punctuation">;</span>

<span class="token comment">#...done.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="四、存储引擎"><a href="#四、存储引擎" class="header-anchor">#</a> 四、存储引擎</h2> <p>查询 <code>mysql</code> 所有支持的存储引擎：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> engines<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查询默认的存储引擎：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'%default_storage_engine%'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_1、myisam"><a href="#_1、myisam" class="header-anchor">#</a> 1、MyISAM</h3> <p><code>MyISAM</code> 是 <code>MySql 5.5</code> 之前默认的存储引擎，是非聚集索引。</p> <p><code>MyISAM</code> 存储引擎由 <code>MYD</code> 和 <code>MYI</code> 组成。</p> <p>创建一个表，并插入数据：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> testmyisam <span class="token punctuation">(</span> id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> myisam<span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> testmyisam <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>执行完后，去到数据库目录下可以看到生成了3个文件：<code>.MYD</code>、<code>.MYI</code>、<code>.frm</code>，其中 <code>.MYI</code> 存放的是索引（<code>index</code>)，<code>.MYD</code> 存放的是数据（<code>data</code>），所以这种引擎的索引和数据是分开放的。</p> <h4 id="_1-表压缩"><a href="#_1-表压缩" class="header-anchor">#</a> (1) 表压缩</h4> <p><code>MyISAM</code> 引擎是支持表压缩的。</p> <p>表压缩的指令：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>myisampack -b -f /usr/local/mysql/data/mall/testmyisam.MYI
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行这个命令后有可能会提示我们需要对表进行修复一下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>myisamchk -r -f /usr/local/mysql/data/mall/testmyisam.MYI
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>此时，这个文件就变成了 <code>read only</code> 状态，无法再往表里面新增数据了。</p> <h4 id="_2-适用场景"><a href="#_2-适用场景" class="header-anchor">#</a> (2) 适用场景</h4> <ul><li>非事务型应用（数据仓库，报表，日志数据）</li> <li>只读类应用</li> <li>空间类应用（空间函数，坐标）</li></ul> <p>由于现在 <code>innodb</code> 越来越强大，<code>myisam</code> 已经停止维护</p> <h3 id="_2、innodb"><a href="#_2、innodb" class="header-anchor">#</a> 2、Innodb</h3> <p><code>MySQL 5.5</code> 及以后版本默认存储引擎就是 <code>Innodb</code></p> <h4 id="_1-特点"><a href="#_1-特点" class="header-anchor">#</a> (1) 特点</h4> <ul><li><code>Innodb</code> 是一种事务性存储引擎</li> <li>完全支持事务得 <code>ACID</code> 特性</li> <li><code>Redo Log</code> 和 <code>Undo Log</code></li> <li><code>Innodb</code> 支持行级锁（并发程度更高）</li></ul> <p>查看创建数据库时使用的是独立表空间还是系统表空间：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> variables <span class="token operator">like</span> <span class="token string">'%innodb_file_per_table%'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>ON</code> 表示使用的是独立表空间，即每个数据库存放的数据都是在一个独立的空间内，<code>OFF</code> 表示使用的是系统表空间，所有数据库的数据都存在 <code>/data/ibdata1</code> （有可能是 <code>ibdata2</code> 等等） 内。</p> <h4 id="_2-适用场景-2"><a href="#_2-适用场景-2" class="header-anchor">#</a> (2) 适用场景</h4> <p>适合于大多数 <code>OLTP</code> 应用。</p> <p>下面是 <code>MyISAM</code> 和 <code>InnoDB</code> 的对比：</p> <table><thead><tr><th>对比项</th> <th>MyISAM</th> <th>InnoDB</th></tr></thead> <tbody><tr><td>主外键</td> <td>不支持</td> <td>支持</td></tr> <tr><td>事务</td> <td>不支持</td> <td>支持</td></tr> <tr><td>行表所</td> <td>表锁，即使操作一条记录也会所住整个表，不适合高并发的操作</td> <td>行锁，操作时只锁某一行，不会对其它行有影响，适合高并发的操作</td></tr> <tr><td>缓存</td> <td>只缓存索引，不缓存真实数据</td> <td>不仅缓存索引还要缓存真实数据，对内存要求较高，而且内存大小对性能有决定性影响</td></tr> <tr><td>表空间</td> <td>小</td> <td>大</td></tr> <tr><td>关注点</td> <td>性能</td> <td>事务</td></tr> <tr><td>默认安装</td> <td>Y</td> <td>Y</td></tr></tbody></table> <h3 id="_3、csv"><a href="#_3、csv" class="header-anchor">#</a> 3、CSV</h3> <h4 id="特点"><a href="#特点" class="header-anchor">#</a> 特点</h4> <ul><li>以 <code>csv</code> 格式进行数据存储</li> <li>所有列都不能为 <code>null</code> 的</li> <li>不支持索引（不适合大表，不适合在线处理）</li> <li>可以对数据文件直接编辑（保存文本文件内容）</li></ul> <p>使用 <code>CSV</code> 引擎创建的表会生成3个文件：<code>.CSM</code>（保存表的元数据如状态和数量）、<code>.CSV</code>（文件存储内容）、<code>.frm</code></p> <p>创建一个表，并插入数据：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mycsv <span class="token punctuation">(</span> id <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> c1 <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> c2 <span class="token keyword">CHAR</span> <span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> csv<span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mycsv
<span class="token keyword">VALUES</span>
	<span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'aaa'</span><span class="token punctuation">,</span> <span class="token string">'bbb'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>
		<span class="token number">2</span><span class="token punctuation">,</span>
		<span class="token string">'cccc'</span><span class="token punctuation">,</span>
	<span class="token string">'dddd'</span> 
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>此时，是可以直接编辑 <code>.CSV</code> 文件对数据做修改的，但是要注意保持和源数据一样的格式，编辑保存后，执行：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>flush <span class="token keyword">TABLES</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后再查询可以看到刚才通过编辑文件修改的表数据。</p> <h3 id="_4、archive"><a href="#_4、archive" class="header-anchor">#</a> 4、Archive</h3> <h4 id="_1-组成"><a href="#_1-组成" class="header-anchor">#</a> (1) 组成</h4> <ul><li>以 <code>zlib</code> 对表数据进行压缩，磁盘 <code>I/O</code> 更少</li> <li>数据存储在 ARZ 为后缀的文件中</li></ul> <h4 id="_2-特点："><a href="#_2-特点：" class="header-anchor">#</a> (2) 特点：</h4> <ul><li>只支持 <code>insert</code> 和 <code>select</code> 操作</li> <li>只允许在自增 <code>ID</code> 列上加索引</li></ul> <p>创建表，并插入数据：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> myarchive <span class="token punctuation">(</span>
	id <span class="token keyword">INT</span> <span class="token keyword">auto_increment</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	c1 <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
c2 <span class="token keyword">CHAR</span> <span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">KEY</span> <span class="token punctuation">(</span> id <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> archive<span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> myarchive <span class="token punctuation">(</span> c1<span class="token punctuation">,</span> c2 <span class="token punctuation">)</span> <span class="token keyword">VALUE</span> <span class="token punctuation">(</span> <span class="token string">'aa'</span><span class="token punctuation">,</span> <span class="token string">'bb'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span> <span class="token string">'cc'</span><span class="token punctuation">,</span> <span class="token string">'dd'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>下面的语句是没法执行成功的：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_c1 <span class="token keyword">ON</span> myarchive <span class="token punctuation">(</span>c1<span class="token punctuation">)</span> <span class="token comment"># Too many keys specified; max 1 keys allowed</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span>	myarchive <span class="token keyword">WHERE</span>	id <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">;</span> <span class="token comment"># Table storage engine for 'myarchive' doesn't have this option</span>
<span class="token keyword">UPDATE</span> myarchive 	<span class="token keyword">SET</span> c1 <span class="token operator">=</span> <span class="token string">'aaa'</span> <span class="token keyword">WHERE</span>	id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">#Table storage engine for 'myarchive' doesn't have this option</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_5、memory"><a href="#_5、memory" class="header-anchor">#</a> 5、Memory</h3> <h4 id="_1-特点-2"><a href="#_1-特点-2" class="header-anchor">#</a> (1) 特点</h4> <ul><li>文件系统存储特点，也称 <code>HEAP</code> 存储引擎，所以数据保存在内存中</li> <li>支持 <code>HASH</code> 索引和 <code>BTree</code> 索引，<code>HASH</code> 索引在做等值查询的时候速度快，而<code>BTree</code> 做范围查询效率高</li> <li>所有字段都是固定长度 <code>varchar(10) = char(10)</code></li> <li>不支持 <code>Blog</code> 和 <code>Text</code> 等大字段</li> <li><code>Memory</code> 存储引擎使用表级锁</li> <li>最大大小由 <code>max_heap_table_size</code> 参数决定</li></ul> <p>查询 <code>max_heap_table_size</code>：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'max_heap_table_size'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在我机器上，查到的是：16777216</p> <p>下面这个语句无法创建成功：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mymemory <span class="token punctuation">(</span> id <span class="token keyword">INT</span><span class="token punctuation">,</span> c1 <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> c2 <span class="token keyword">CHAR</span> <span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> c3 <span class="token keyword">text</span> <span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> memory<span class="token punctuation">;</span> <span class="token comment"># The used table type doesn't support BLOB/TEXT columns</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建表并创建索引：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mymemory <span class="token punctuation">(</span>
	id <span class="token keyword">INT</span><span class="token punctuation">,</span>
	c1 <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
c2 <span class="token keyword">CHAR</span> <span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> memory<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_c1 <span class="token keyword">ON</span> mymemory <span class="token punctuation">(</span> c1 <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_c2 <span class="token keyword">USING</span> <span class="token keyword">BTREE</span> <span class="token keyword">ON</span> mymemory <span class="token punctuation">(</span> c2 <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>通过：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">INDEX</span> <span class="token keyword">FROM</span>	mymemory<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以看出默认创建的索引是 <code>HASH</code> 索引。</p> <h4 id="_2-临时表"><a href="#_2-临时表" class="header-anchor">#</a> (2) 临时表</h4> <p>使用 <code>create temporary table</code> 来创建临时表。</p> <p>临时表分为两种，一种是系统使用的临时表，一种是用户创建的临时表。当系统创建表时超过了限制（例如大于最大容量）就会使用 <code>Myisam</code> 引擎来创建，未超过限制时才会使用 <code>Memory</code> 引擎。</p> <h4 id="_3-使用场景"><a href="#_3-使用场景" class="header-anchor">#</a> (3) 使用场景</h4> <ul><li>hash 索引用于查找或者是映射表（邮编和地区的对应表）</li> <li>用于保存数据分析中产生的中间表</li> <li>用于缓存周期性聚合数据的结果表</li></ul> <h3 id="_6、ferderated"><a href="#_6、ferderated" class="header-anchor">#</a> 6、Ferderated</h3> <h4 id="_1-特点-3"><a href="#_1-特点-3" class="header-anchor">#</a> (1) 特点</h4> <ul><li>提供了访问远程 <code>MySQL</code> 服务器上表的方法</li> <li>本地不存储数据，数据全部放到远程服务器上</li> <li>本地需要保存表结构和远程服务器的连接信息</li></ul> <h4 id="_2-使用场景"><a href="#_2-使用场景" class="header-anchor">#</a> (2) 使用场景</h4> <p>偶尔的统计分析及手工查询（某些游戏行业）</p> <p>在使用 <code>SHOW ENGINES</code> 查看的时候，发现 <code>Ferderated</code> 引擎默认是关闭的，需要开启：修改 <code>/etc/my.cnf</code> 在文件顶部加入：</p> <div class="language-cnf line-numbers-mode"><pre class="language-text"><code>[mysqld]
sql_mode=&quot;STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER&quot;
federated
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>其中 <code>federated</code> 就是需要加的。</p> <p>然后重启 <code>mysql</code> 服务即可：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>/etc/inint.d/mysql stop
/etc/inint.d/mysql start
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>首先模拟创建一个本地库，这个库里面的表，不存放数据，是用来远程连接别的库的：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">local</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后模拟创建一个远程库，这个库用来存放表和数据：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> remote<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>进入 <code>remote</code> 库，创建表，并插入数据：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> remote_fed <span class="token punctuation">(</span>
	id <span class="token keyword">INT</span> <span class="token keyword">auto_increment</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	c1 <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span><span class="token punctuation">,</span>
c2 <span class="token keyword">CHAR</span> <span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> id <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> remote_fed <span class="token punctuation">(</span> c1<span class="token punctuation">,</span> c2 <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> <span class="token string">'aaa'</span><span class="token punctuation">,</span> <span class="token string">'bbb'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span> <span class="token string">'ccc'</span><span class="token punctuation">,</span> <span class="token string">'ddd'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span> <span class="token string">'eee'</span><span class="token punctuation">,</span> <span class="token string">'fff'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>接下来进入本地库 <code>local</code>，创建表：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>local_fed<span class="token punctuation">`</span> <span class="token punctuation">(</span>
	<span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span> <span class="token punctuation">(</span> <span class="token number">11</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>c1<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>c2<span class="token punctuation">`</span> <span class="token keyword">CHAR</span> <span class="token punctuation">(</span> <span class="token number">10</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token punctuation">)</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> federated CONNECTION <span class="token operator">=</span> <span class="token string">'mysql://root:123456@112.126.97.128:3306/remote/remote_fed'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>接下来查询本地表：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> local_fed
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>居然可以查到 <code>remote</code> 库中 <code>remote_fed</code> 表的内容，并且删除的话，<code>remote</code> 库 <code>remote_fed</code> 表的数据也会被删除。</p> <div><br> <div id="vcomments"></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020-08-21 09:02:51（10 小时前）</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/my-blog/backend/MySQL安装和基础数据类型.html" class="prev">
        MySQL安装和基础数据类型
      </a></span> <span class="next"><a href="/my-blog/backend/MySQL锁与事务的分析.html">
        MySQL锁与事务的分析
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/my-blog/assets/js/app.11c55fdf.js" defer></script><script src="/my-blog/assets/js/2.f643b0a2.js" defer></script><script src="/my-blog/assets/js/23.f9133433.js" defer></script><script src="/my-blog/assets/js/4.fd36f240.js" defer></script><script src="/my-blog/assets/js/5.628d6842.js" defer></script>
  </body>
</html>
